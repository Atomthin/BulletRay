tinymce.PluginManager.add('uploadimage', function (editor) {

    function selectLocalImages() {
        var dom = editor.dom;
        var input_f = $('<input type="file" name="thumbnail" accept="image/jpg,image/jpeg,image/png,image/gif" multiple="multiple">');
        input_f.on('change', function () {
            var formData = new FormData();
            formData.append("file", $(this)[0].files[0]);
            $.ajax({
                type: "post",
                url: editor.settings.upload_image_url,
                contentType: false,
                processData: false,
                data: formData,
                success: function (data) {
                    if (data.success == true && data.result.url != "") {
                        editor.selection.setContent(dom.createHTML('img', { src: data.result.url }));
                    } else {
                        abp.message.error("上传图片失败，稍后再试！")
                    }
                }
            });
        });
        input_f.click();
    }

    editor.addCommand("mceUploadImageEditor", selectLocalImages);

    editor.addButton('uploadimage', {
        icon: 'image',
        tooltip: '上传图片',
        onclick: selectLocalImages
    });

    editor.addMenuItem('uploadimage', {
        icon: 'image',
        text: '上传图片',
        context: 'tools',
        onclick: selectLocalImages
    });
});